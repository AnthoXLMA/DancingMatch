<div class ="container-map" style="height:600px; width:100%;">
<!--   <div id="resultats"
  data-users="<%= @users_selected.to_json %>">
  </div> -->
  <div id="map"
  data-dancers="<%= @dancers.to_json %>"
  data-events="<%= @events.to_json %>"
  data-map-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
  <nav id="filter-group" class="filter-group"></nav>
</div>
<div class="grid-user" style="display:flex;">
  <div class="contain-user">
    <% @users.each do |i| %>
    <div class="card-community">
        <div class="image-user-card">
          <%= cl_image_tag i.photo.key if i.photo.attached? %>
        </div>
        <!-- <div class="user-details">
          <ul>
            <li><%= link_to i.first_name, user_profiles_path(i) %> <%= i.age %></li>
            <li><%= i.city %></li>
            <li><%= link_to "See More Details", user_profiles_path(i) %></li>
          </ul>
        </div> -->
    </div>
    <% end %>
  </div>
  <div class="search-motor">
    <div class="contain-3">
      <div class="card-search-types">
      <%= simple_form_for users_path, method: :get do |f| %>
        <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "OÃ¹?" %>
        <%= submit_tag "Search", class: "btn btn-primary" %>
      <% end %>
      </div>
    </div>
    <div class="contain-3">
      <div class="card-search-types">
        <%= simple_form_for users_path, method: :get do |f| %>
        <input type="checkbox" name="gender_query" value="lady"        /> Lady
        <input type="checkbox" name="gender_query" value="gentleman"   /> Gentleman
        <%= submit_tag "Search", class: "btn btn-primary" %>
      <% end %>
      </div>
    </div>
    <div class="contain-3">
      <div class="card-search-types">
        <%= simple_form_for users_path, method: :get do %>
        <%= text_field_tag :name_query, params[:name_query], class: "form-control", placeholder: "Pseudo?" %>
        <%= submit_tag "Search", class: "btn btn-primary" %>
      <% end %>
      </div>
    </div>
  </div>
</div>

<script>
// const initMapbox = () => {
const mapElement = document.getElementById('map');
  if (mapElement) {
  mapboxgl.accessToken = 'pk.eyJ1IjoiYW50bWFuNDMiLCJhIjoiY2x3eHk0aWF1MWY2bzJucjFodnEwemRwayJ9.O7VyKyjd4FebVbtQPuGj7g';
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [2.35, 48.853],
    zoom:11,
  });
const dancers = JSON.parse(mapElement.dataset.dancers);
  dancers.forEach((dancer) => {
  const popup   = new mapboxgl.Popup().setHTML(dancer.infoWindow);
  const element = document.createElement('div');
    element.className = 'icon-dancer';
    element.style.backgroundImage = `url('${dancer.image_url}')`;
    element.style.backgroundSize  = 'cover';
    element.style.width   = '30px';
    element.style.height  = '30px';
    new mapboxgl.Marker(element)
    .setLngLat([dancer.lng, dancer.lat])
    .setPopup(popup)
    .addTo(map)
  });
  map.addControl(
    new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl
    })
  );
  // events_dance_id_location
  const events = JSON.parse(mapElement.dataset.events);
    events.forEach((event) => {
  const popup   = new mapboxgl.Popup().setHTML(event.infoWindow);
  const e = document.createElement('div');
    e.className = 'icon-show';
    e.style.backgroundImage = `url('${event.image_url}')`;
    e.style.backgroundSize  = 'cover';
    e.style.width   = '40px';
    e.style.height  = '40px';
  new mapboxgl.Marker(e)
  .setLngLat([event.lng, event.lat])
  .setPopup(popup)
  .addTo(map);
  });
};
// export { initMapbox } ;
</script>

