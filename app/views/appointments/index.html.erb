<div class="container-card-profile">
  <div class="map-n-card">
    <div class="bouton-n-card">
      <h3>Rechercher un événement</h3>
          <%= form_tag appointments_path, method: :get do %>
            <%= text_field_tag :query, params[:appointment], class:"form-control", placeholder: "Lieu, ville ou événement" %>
            <%= submit_tag "Search", class:"btn btn-primary" %>
          <% end %>
        <div class="title_text">
          <p><%= link_to "Crée ton évenement", new_appointment_path, class:"btn btn-primary", id: "dance" %></p>
        </div>
        <div class ="container-appointments">
          <% @appointments.each do |appointment| %>
          <div class="appointment-card3">
            <div class="image-card-appointments">
              <%= image_tag appointment.pic if appointment.pic.attached? %>
            </div>
            <div class="information-event">
              <div id="event-uptitle">
                <h3><%= appointment.name  %></h3>
                <a><%= appointment.address %></a>
              </div>
              <div id="event-subinformations">
                <p> <%= appointment.dance.title %></p>
                <p> <%= appointment.user.first_name %></p>
                <p> Début: <%= appointment.start_on %></p>
                <p> Fin: <%= appointment.end_on %></p>
              </div>
            </div>
              <div id="click-participate">
                <input type="submit" class="btn btn-primary" value="Je participe">
              </div>
              <div class="horo" style="background-color:red; width:100px; height:20px; ">
                <ul id="cours"></ul>
              </div>
            </div>
          <% end %>
        </div>
    </div>
    <div class="container-map">
      <div id="map"
        data-markers="<%= @markers.to_json %>"
        data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>
    </div>
  </div>
  <div class="container text-center">
    <ul id="results" class="list-inline"></ul>
  </div>
</div>
<script>
  // const list = document.querySelector('#results');

  // const insertEvents = (data) => {
  //   data.Search.forEach((result) => {
  //     const eventTag = `<li>
  //       <img src="${result.appointment.name}" alt="" />
  //       <p>${result.appointment.pic}</p>
  //     </li>`;
  //     list.insertAdjacentHTML('beforeend', eventTag);
  //   });
  // };

  // const fetchEvents = (query) => {
  //   fetch(`http://www.omdbapi.com/?s=${query}&apikey=YOUR_API_KEY`)
  //     .then(response => response.json())
  //     .then(insertEvents);
  // };

  // fetchEvents('harry potter');

  // var buttons = document.querySelectorAll('#click-participate');
  // // const results = document.querySelector("#results")
  // var button = buttons.forEach(button => {
  //   button.addEventListener('submit', (event) => {
  //     event.preventDefault()
  //     const input = event.currentTarget.querySelector("#results")
  //     results.innerHTML = ""
  //     searchMovies(input.value)
  //   })
  // });
</script>
<script>

//   const fetchMovies = (query) => {
//     fetch(`http://www.omdbapi.com/?s=${query}&apikey=YOUR_API_KEY`)
//       .then(response => response.json())
//       .then(insertMovies);
//   };

//   const form = document.querySelector('#search-form');
//   form.addEventListener('submit', (event) => {
//     event.preventDefault();
//     list.innerHTML = '';
//     const input = document.querySelector('#search-input');
//     fetchMovies(input.value);
// });
</script>
<script>
// var buttons = document.querySelectorAll('#click-participate');
//   // const results = document.querySelector("#results")
//   var button = buttons.forEach(button => {
//     button.addEventListener('click', (event) => {
//         function getCours() {
            /* APPEL VERS AJAX VERS CRYPTOCOMPARE.COM */
//          // var ajax = new XMLHttpRequest();
  //         console.log("readyState après new: "+ajax.readyState);
  //         ajax.onreadystatechange = function() {
  //           console.log("readyState a changé et vaut :"+ajax.readyState)
//           }
              /* DETECTION DE LA FIN DE L'APPEL */
//           ajax.onload = function() {
//             if (this.status == 200) { /* Le service a bien répondu */
//               var json = JSON.parse(this.response);
//               var eur = formatMontant(json.EUR);
//               var dt = new Date();
//               document.getElementById("cours").innerHTML=eur+ "&euro;";
//               document.querySelector("div#horo").innerHTML="Maj "+dt.toLocaleString();
//             }
//           }
//
//           var url = "https://min-api.cryptocompare.com/data/price?fsym=BTC&tsyms=EUR"
//           ajax.open("GET", url, true);
//           ajax.send();
//         }
//     })
//   });
</script>

<script>
var buttons = document.querySelectorAll('#click-participate');
// const results = document.querySelector("#results")
var button  = buttons.forEach(button => {
  var callajax = button.addEventListener('click', (event) => {
  function reqListener () {
    console.log(this.responseText);
    var json  = JSON.parse(this.response);
    var eur   = parseInt(json.EUR);
    var dt    = new Date();
    document.getElementById("cours").innerHTML=eur+ "&euro;";
    // document.querySelector("#results").innerHTML="Maj "+dt.toLocaleString();
  }
  var oReq    = new XMLHttpRequest();
  oReq.addEventListener("load", reqListener);
  oReq.open("GET", "https://min-api.cryptocompare.com/data/price?fsym=BTC&tsyms=EUR");
  oReq.send();
    })
});
</script>
